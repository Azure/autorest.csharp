# Generate SDK codes

parameters:
  Name: ''
  AutorestCSharpVersion: ''
  IsInternalFeed: false
  Matrix: {}
  DependsOn: []

jobs:
- job: ${{ parameters.Name }}
  timeoutInMinutes: 60
  pool:
    name: azsdk-pool-mms-ubuntu-2004-general
    vmImage: ubuntu-20.04
  strategy:
    matrix: ${{ parameters.Matrix }}
  dependsOn: ${{ parameters.DependsOn }}
  steps:
  - checkout: self
    fetchDepth: 1
  - checkout: azure-sdk-tools
    fetchDepth: 1
  - template: eng/common/pipelines/templates/steps/sparse-checkout.yml@azure-sdk-tools
    parameters:
      Paths:
      - "/*"
      - "!SessionRecords"
      Repositories:
      - Name: azure-sdk/azure-sdk-for-net
        Commitish: auto-update-autorest-${{ parameters.AutorestCSharpVersion }}
        WorkingDirectory: $(Build.SourcesDirectory)/azure-sdk-for-net
      SkipCheckoutNone: true
  - task: UseDotNet@2
    displayName: 'Use .NET Core SDK'
    inputs:
      useGlobalJson: true
      performMultiLevelLookup: true
  - task: DownloadPipelineArtifact@2
    displayName: Download job matrix props files
    inputs:
      artifact: matrix-props
      targetPath: $(Build.SourcesDirectory)/azure-sdk-for-net/artifacts/matrix-props
  - task: Powershell@2
    displayName: Build SDK codes
    inputs:
      pwsh: true
      filePath: $(Build.SourcesDirectory)/autorest.csharp/eng/BuildAzureSdkForNet.ps1
      arguments: >
        -SdkRepoRoot $(Build.SourcesDirectory)/azure-sdk-for-net
        -ProjectListOverrideFile artifacts/matrix-props/$(ProjectListOverrideFile)
        -ShowSummary
      failOnStderr: false
      workingDirectory: $(Build.SourcesDirectory)/azure-sdk-for-net
